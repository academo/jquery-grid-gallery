/*
 *  jQuery GridGallery - v0.1
 *  An expandible jquery grid gallery
 *  https://github.com/academo/jquery-grid-gallery
 *
 *  Made by Esteban Beltran
 *  Under MIT License
 */
!function(a){function b(b,e){this.element=a(b),this.settings=a.extend({},d,e),this._defaults=d,this._name=c,this.init(b,e),this.trigger=[]}var c="gridGallery",d={showControllers:!0,nextTpl:'<a href="#"></a>',prevTpl:'<a href="#"</a>',closeTpl:'<a href="#"></a>',indicatorTpl:"<i></i>",onShowElement:function(){},onCloseElement:function(){},onShow:function(){},onClose:function(){},onNext:function(){},onPrev:function(){}};b.prototype={init:function(){this.element.addClass("grid-gallery"),this.element.on("click","li > a",a.proxy(this.expandContent,this)),this.settings.showControllers&&this.element.on("click","li > .content > .control",a.proxy(this.manageControl,this))},expandContent:function(b){b.preventDefault();var c=a(b.currentTarget).parent();this.toggleElement(c)},toggleElement:function(b){return b.data("original-height",b.data("original-height")||b.height()),b.hasClass("expanded")?this.hideElement(b).then(a.proxy(this.settings.onClose,this,b)):this.showElement(b,a("li.expanded",this.element).removeClass("expanded"))},hideElement:function(b){return b.removeClass("expanded"),a.when(b.animate({height:b.data("original-height")}),a(".content",b).slideUp()).then(a.proxy(this.settings.onCloseElement,this,b))},showElement:function(b,c){var d=a(".content",b);a("li:first",this.element).offset(),b.addClass("expanded"),d.css({width:b.parent().width()}),this.settings.showControllers&&!d.hasClass("expanded-controls")&&this.initializeControllers(d,b);var e=b.outerHeight()+a(".content",b).outerHeight();return 0==c.length||c.offset().top!=b.offset().top?(c.length>0&&c.offset().top!=b.offset().top&&this.hideElement(c),a.when(b.animate({height:e}),d.slideToggle()).then(a.proxy(function(){0==c.length&&(this.settings.onShow.call(this,b),this.settings.onShowElement.call(this,b))},this,c))):(a(".content",c).fadeOut(300),b.height(e),this.hideElement(c),d.fadeIn(300).promise().then(a.proxy(this.settings.onShowElement,this,b,c)))},initializeControllers:function(b,c){a(this.settings.nextTpl).addClass("control next").appendTo(b),a(this.settings.prevTpl).addClass("control prev").appendTo(b),a(this.settings.closeTpl).addClass("control close").appendTo(b),a(this.settings.indicatorTpl).addClass("indicator").appendTo(b),a(".indicator",b).css({left:c.offset().left+c.outerHeight()/2+"px"}),b.addClass("expanded-controls")},manageControl:function(b){b.preventDefault();var c,d,e=a(b.currentTarget),f=e.closest("li.expanded");return e.hasClass("close")?(this.toggleElement(f).then(this.settings.onClose),void 0):(e.hasClass("prev")&&(c=f.prev("li"),d=a.proxy(this.settings.onPrev,this,c,f)),e.hasClass("next")&&(c=f.next("li"),d=a.proxy(this.settings.onNext,this,c,f)),c.length>0&&this.toggleElement(c).then(d),void 0)}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery);